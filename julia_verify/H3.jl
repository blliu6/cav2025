include("utils/util.jl")
include("utils/newtonUpdate.jl")
include("utils/rationalSOS.jl")

X = nothing
eig_tol = 1e-6
tol = 1e-50

SOS_time = 0
Newton_time = 0
function solve(n, X, f, Q, mono,newton)
    global SOS_time, Newton_time
    Q = round.(Q, digits=2)
    rQ = symplify_rational.(Q)

    model = nothing
    if !newton
        model = rational_SOS(f, 1, 0, mono, rQ)
    else
        Newton_time+=@elapsed update_Q = newton_refine_update(f, mono, Q, eig_tol, 90, tol, X)
        Q_res = symplify_rational.(update_Q*update_Q')
        SOS_time+=@elapsed model = rational_SOS(f, 1, 0, mono, Q_res)
    end
    
    SOSrational_time, coeffs, terms = model[2:end]
    
    @show expand(f-(coeffs' * terms.^2))

    data = Dict(
        "n" => n,
        "expression" => f,
        "coeff" => join([string(c) for c in coeffs], ","),
        "term" => join([string(t) for t in terms], ","),
        "SOSrational_time" => SOSrational_time,
        "SOS_expression" => string(coeffs' * terms.^2)
    )

    # save("src/output/data.json", data)    
end

n = 2
@Symbolics.variables X[1:n]

#H3
# third
## Multiplier-2
P0 = 8239*X[1]^2//1000 + 683*X[1]*X[2]//200 - 311*X[1]//250 + 5993*X[2]^2//1000 + 511*X[2]//200 + 1517//500
M0 = [1, X[2], X[1]]
Q0 = [3.033921777554623 1.2777842711111638 -0.6225278838483942;
 1.2777842711111638 5.993300617387357 1.7070490562445049;
 -0.6225278838483942 1.7070490562445049 8.238837464875465;
]
solve(n, X, P0, Q0, M0, true)
## Total Decomposition
P1 = 10921*X[1]^4//2000 + 17501*X[1]^3*X[2]//10000 - 62939*X[1]^3//10000 + 65971*X[1]^2*X[2]^2//10000 - 791*X[1]^2*X[2]//625 - 21613*X[1]^2//10000 - 42151*X[1]*X[2]^3//10000 + 90399*X[1]*X[2]^2//100000 - 7449*X[1]*X[2]//500 + 1971*X[1]//500 + 2749*X[2]^4//625 - 40437*X[2]^3//10000 + 24781*X[2]^2//2500 - 6459*X[2]//500 + 15161//1000
M1 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q1 = [15.160828686343928 -6.454460589124348 1.9666411746163002 0.5145502436865387 -4.947383137111528 -4.446911719493627;
 -6.454460589124348 8.878011402053263 -2.503960245434481 -2.0234207533207162 0.6484291438178932 1.2580765840987078;
 1.9666411746163002 -2.503960245434481 6.723181908455116 -0.19329028501261097 -1.8876080066841627 -3.1471604164245544;
 0.5145502436865387 -2.0234207533207162 -0.19329028501261097 4.399616251008508 -2.105839418815289 -0.3253535408732047;
 -4.947383137111528 0.6484291438178932 -1.8876080066841627 -2.105839418815289 7.243944183616848 0.8772919155650889;
 -4.446911719493627 1.2580765840987078 -3.1471604164245544 -0.3253535408732047 0.8772919155650889 5.464230924275948;
]
solve(n, X, P1, Q1, M1, true)
## Multiplier-1
P2 = 2311*X[1]^2//500 + 1463*X[1]*X[2]//1000 - 541*X[1]//1000 + 5441*X[2]^2//1000 + 1361*X[2]//2000 + 2181//500
M2 = [1, X[2], X[1]]
Q2 = [4.362456777198167 0.3409417161773734 -0.2724501079361487;
 0.3409417161773734 5.4410375053229485 0.7311833768274127;
 -0.2724501079361487 0.7311833768274127 4.622100546510181;
]
solve(n, X, P2, Q2, M2, true)
# second
## Multiplier-2
P3 = 213*X[1]^2//40 + 3257*X[1]*X[2]//10000 + 1387*X[1]//1000 + 1251*X[2]^2//200 + 763*X[2]//1250 + 111//20
M3 = [1, X[2], X[1]]
Q3 = [5.549670829440052 0.306501162647323 0.6960946180529307;
 0.306501162647323 6.255248979924368 0.16286828763532954;
 0.6960946180529307 0.16286828763532954 5.32581798411275;
]
solve(n, X, P3, Q3, M3, true)
## Total Decomposition
P4 = 77551*X[1]^4//10000 - 6447*X[1]^3*X[2]//1250 - 3803*X[1]^3//1000 + 5051*X[1]^2*X[2]^2//250 - 12*X[1]^2*X[2]//5 + 4343*X[1]^2//500 - 4311*X[1]*X[2]^3//500 - 4967*X[1]*X[2]^2//500 + 2393*X[1]*X[2]//250 + 231*X[1]//125 + 9371*X[2]^4//1000 - 699*X[2]^3//250 + 1377*X[2]^2//200 - 3461*X[2]//1000 + 8401//1000
M4 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q4 = [8.400710192089425 -1.7302689747047866 0.9271596123809311 -1.2713839073822697 2.869475692260141 -0.6666695718202243;
 -1.7302689747047866 9.422158438702553 1.9121304252730218 -1.397773735924416 -2.346764516480933 -1.0389324736807342;
 0.9271596123809311 1.9121304252730218 10.014516458296916 -2.6156427962518185 -0.15587334395496677 -1.9031076580837931;
 -1.2713839073822697 -1.397773735924416 -2.6156427962518185 9.371350504798516 -4.309450550950919 2.7524248297310963;
 2.869475692260141 -2.346764516480933 -0.15587334395496677 -4.309450550950919 14.687246815407073 -2.5761835162345164;
 -0.6666695718202243 -1.0389324736807342 -1.9031076580837931 2.7524248297310963 -2.5761835162345164 7.753017276052873;
]
solve(n, X, P4, Q4, M4, true)
## Multiplier-1
P5 = 827*X[1]^2//125 - 3669*X[1]*X[2]//100000 + 5211*X[1]//10000 + 2613*X[2]^2//500 + 1683*X[2]//1000 + 167//25
M5 = [1, X[2], X[1]]
Q5 = [6.680162107153725 0.8426230476183373 0.26060837882239585;
 0.8426230476183373 5.2258334648977645 -0.01881223553365727;
 0.26060837882239585 -0.01881223553365727 6.615884431041358;
]
solve(n, X, P5, Q5, M5, true)
# seventh
## Multiplier-2
P6 = 559*X[1]^2//1000 - 183*X[1]*X[2]//2000 + 457*X[1]//10000 + 287*X[2]^2//500 + 163*X[2]//500 + 56//125
M6 = [1, X[2], X[1]]
Q6 = [0.4477248724556449 0.16299751528899398 0.022827913825161007;
 0.16299751528899398 0.5746325461666046 -0.045994865974478924;
 0.022827913825161007 -0.045994865974478924 0.5587006334461385;
]
solve(n, X, P6, Q6, M6, true)
## Total Decomposition
P7 = 1073*X[1]^4//2500 - 1251*X[1]^3*X[2]//10000 - 1051*X[1]^3//1000 + 503*X[1]^2*X[2]^2//500 - 8737*X[1]^2*X[2]//10000 + 613*X[1]^2//500 - 1161*X[1]*X[2]^3//12500 - 1089*X[1]*X[2]^2//1000 - 4589*X[1]*X[2]//10000 - 989*X[1]//2000 + 359*X[2]^4//625 - 9513*X[2]^3//10000 + 1367*X[2]^2//1000 - 6071*X[2]//10000 + 306//125
M7 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q7 = [2.4480106964096398 -0.30301817124670183 -0.2472258237336332 0.0029571322605285773 -0.511438056321912 -0.11921099859664308;
 -0.30301817124670183 1.3619597476775476 0.2826936411746029 -0.4762811991617332 -0.2756214935089274 -0.16821247398534434;
 -0.2472258237336332 0.2826936411746029 1.466335299317782 -0.2698198789442393 -0.2691154989853625 -0.5256586638410661;
 0.0029571322605285773 -0.4762811991617332 -0.2698198789442393 0.5746325461666053 -0.04599486597448009 0.09961394956541986;
 -0.511438056321912 -0.2756214935089274 -0.2691154989853625 -0.04599486597448009 0.8065446437607191 -0.0624668318223144;
 -0.11921099859664308 -0.16821247398534434 -0.5256586638410661 0.09961394956541986 -0.0624668318223144 0.4291832461361463;
]
solve(n, X, P7, Q7, M7, true)
## Multiplier-1
P8 = 429*X[1]^2//1000 - X[1]*X[2]//8 + 59*X[1]//250 + 447*X[2]^2//1000 - 629*X[2]//100000 + 87//250
M8 = [1, X[2], X[1]]
Q8 = [0.34822549276809645 -0.0031740070783723875 0.11811620535000898;
 -0.0031740070783723875 0.44707190945419706 -0.06246683182231822;
 0.11811620535000898 -0.06246683182231822 0.42918324613615416;
]
solve(n, X, P8, Q8, M8, true)
# eighth
## Multiplier-2
P9 = 3093*X[1]^2//500 - 3607*X[1]*X[2]//10000 - 4233*X[1]//5000 + 1283*X[2]^2//200 + 1457*X[2]//500 + 407//50
M9 = [1, X[2], X[1]]
Q9 = [8.139908663498243 1.4564456109224748 -0.42216093161320306;
 1.4564456109224748 6.41430340506024 -0.1820200589061831;
 -0.42216093161320306 -0.1820200589061831 6.186188444988908;
]
solve(n, X, P9, Q9, M9, true)
## Total Decomposition
P10 = 79661*X[1]^4//10000 + 16043*X[1]^3*X[2]//10000 - 16627*X[1]^3//2000 + 6313*X[1]^2*X[2]^2//500 - 3049*X[1]^2*X[2]//250 + 16423*X[1]^2//10000 - 36891*X[1]*X[2]^3//100000 - 1117*X[1]*X[2]^2//100 - 283*X[1]*X[2]//25 + 957*X[1]//2000 + 32063*X[2]^4//5000 - 19963*X[2]^3//2500 + 4959*X[2]^2//500 + 163*X[2]//40 + 8859//1000
M10 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q10 = [8.85935910411763 2.0390712167799996 0.23837081252410083 -1.296212871906152 -4.7050402703779906 -3.6569966300837797;
 2.0390712167799996 12.505489859930842 -0.9566670429517157 -3.9957122450430433 -4.3866757961397935 -3.320163624358341;
 0.23837081252410083 -0.9566670429517157 8.960218946711752 -1.2024301212873314 -2.7731147129774807 -4.158610244194258;
 -1.296212871906152 -3.9957122450430433 -1.2024301212873314 6.414303405060231 -0.18202005890623696 0.928148421770115;
 -4.7050402703779906 -4.3866757961397935 -2.7731147129774807 -0.18202005890623696 10.772690568726468 0.8018876534003534;
 -3.6569966300837797 -3.320163624358341 -4.158610244194258 0.928148421770115 0.8018876534003534 7.965171673346773;
]
solve(n, X, P10, Q10, M10, true)
## Multiplier-1
P11 = 1593*X[1]^2//200 + 4009*X[1]*X[2]//2500 + 26119*X[1]//5000 + 64427*X[2]^2//10000 + 10493*X[2]//10000 + 2141//200
M11 = [1, X[2], X[1]]
Q11 = [10.704563095868432 0.5281908051502063 2.6117856305718083;
 0.5281908051502063 6.4427989673993205 0.8018876534001871;
 2.6117856305718083 0.8018876534001871 7.965171673346962;
]
solve(n, X, P11, Q11, M11, true)
# first
## Total Decomposition
P12 = 34333*X[1]^4//5000 - 44501*X[1]^3*X[2]//500000 - 79579*X[1]^3//10000 + 2793*X[1]^2*X[2]^2//200 - 17407*X[1]^2*X[2]//10000 + 94529*X[1]^2//10000 - 87701*X[1]*X[2]^3//1000000 - 8293*X[1]*X[2]^2//1000 - 97461*X[1]*X[2]//10000 + 25153*X[1]//5000 + 70947*X[2]^4//10000 - 19829*X[2]^3//10000 + 14881*X[2]^2//1000 - 1557*X[2]//125 + 10143//500
M12 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q12 = [20.285515538865766 -6.223554235377724 2.5064896008007254 0.772632346269265 -2.7246064750866457 -1.0673717716588131;
 -6.223554235377724 13.336449023004562 -2.1552531160633 -0.9889358219326009 -2.3474160535036854 0.21697546429745504;
 2.5064896008007254 -2.1552531160633 11.601108566026706 -1.7922706986301113 -1.081227529166166 -3.974634355296881;
 0.772632346269265 -0.9889358219326009 -1.7922706986301113 7.093787406637519 -0.049070974477411995 0.9432654870326763;
 -2.7246064750866457 -2.3474160535036854 -1.081227529166166 -0.049070974477411995 12.070192858999176 -0.04907097447741189;
 -1.0673717716588131 0.21697546429745504 -3.974634355296881 0.9432654870326763 -0.04907097447741189 6.862936426427006;
]
solve(n, X, P12, Q12, M12, true)
## Multiplier-1
P13 = 858*X[1]^2//125 - 513*X[1]*X[2]//5000 + 607*X[1]//200 + 3547*X[2]^2//500 + 2157*X[2]//2500 + 843//125
M13 = [1, X[2], X[1]]
Q13 = [6.743867846493148 0.42982168053603576 1.5157148676573067;
 0.42982168053603576 7.093787406637519 -0.04907097447741143;
 1.5157148676573067 -0.04907097447741143 6.862936426427005;
]
solve(n, X, P13, Q13, M13, true)
# fifth
## Multiplier-2
P14 = 153*X[1]^2//20 + 572*X[1]*X[2]//625 - 1117*X[1]//500 + 717*X[2]^2//100 + 2303*X[2]//1000 + 2471//500
M14 = [1, X[2], X[1]]
Q14 = [4.941736183674732 1.1517337331933037 -1.1144259967056325;
 1.1517337331933037 7.170396377978534 0.4599755411621235;
 -1.1144259967056325 0.4599755411621235 7.648949642546263;
]
solve(n, X, P14, Q14, M14, true)
## Total Decomposition
P15 = 63233*X[1]^4//10000 + 2091*X[1]^3*X[2]//1250 - 746*X[1]^3//125 + 41383*X[1]^2*X[2]^2//5000 - 25281*X[1]^2*X[2]//10000 + 72271*X[1]^2//10000 - 24027*X[1]*X[2]^3//5000 - 312*X[1]*X[2]^2//125 - 25107*X[1]*X[2]//1000 + 16947*X[1]//2000 + 29909*X[2]^4//5000 - 9297*X[2]^3//2000 + 10721*X[2]^2//1000 - 347*X[2]//25 + 3484//125
M15 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q15 = [27.872446077417862 -6.944346369058339 4.240808386912843 -0.5084336688634472 -8.385854915098832 -2.2110978173404074;
 -6.944346369058339 11.727226635014857 -4.1628060147648425 -2.320190623661268 -0.18149960783042426 0.5000277246215353;
 4.240808386912843 -4.1628060147648425 11.629122672101737 -1.0731668397020206 -1.7576331077891703 -2.9893954627179924;
 -0.5084336688634472 -2.320190623661268 -1.0731668397020206 5.981984611488336 -2.4020002675259557 -1.0363193037168095;
 -8.385854915098832 -0.18149960783042426 -1.7576331077891703 -2.4020002675259557 10.347630680734747 0.8383468722766755;
 -2.2110978173404074 0.5000277246215353 -2.9893954627179924 -1.0363193037168095 0.8383468722766755 6.327936886334187;
]
solve(n, X, P15, Q15, M15, true)
## Multiplier-1
P16 = 5929*X[1]^2//1000 + 234*X[1]*X[2]//125 + 6901*X[1]//10000 + 6141*X[2]^2//1000 - 1621*X[2]//1000 + 5003//1000
M16 = [1, X[2], X[1]]
Q16 = [5.003428305043377 -0.8120674395154289 0.34544531793283134;
 -0.8120674395154289 6.141789997494459 0.9373155575629776;
 0.34544531793283134 0.9373155575629776 5.929680652545602;
]
solve(n, X, P16, Q16, M16, true)
# fourth
## Multiplier-2
P17 = 24131*X[1]^2//1000 - 72217*X[1]*X[2]//100000 + 16933*X[1]//2500 + 24589*X[2]^2//1000 + 43407*X[2]//5000 + 30787//1000
M17 = [1, X[2], X[1]]
Q17 = [30.787232001750677 4.352954671593178 3.38960394206738;
 4.352954671593178 24.592305927531264 -0.35060726528526814;
 3.38960394206738 -0.35060726528526814 24.13114380679207;
]
solve(n, X, P17, Q17, M17, true)
## Total Decomposition
P18 = 31233*X[1]^4//1000 + 11879*X[1]^3*X[2]//1000 - 26659*X[1]^3//1000 + 35749*X[1]^2*X[2]^2//1000 - 27571*X[1]^2*X[2]//1000 + 502*X[1]^2//5 - 837*X[1]*X[2]^3//125 - 10389*X[1]*X[2]^2//1000 + 18279*X[1]*X[2]//500 - 5248*X[1]//125 + 32159*X[2]^4//1000 - 4517*X[2]^3//100 + 25053*X[2]^2//1000 + 8531*X[2]//2000 + 64589//1000
M18 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q18 = [64.58907884320226 2.1126852480980025 -20.990150555548865 -11.924653657770566 10.069997381652845 16.522416277968546;
 2.1126852480980025 48.94880470416395 8.215501133152095 -22.576137234824078 -3.333963796477817 -0.7835579992866226;
 -20.990150555548865 8.215501133152095 67.33779119098054 -1.8455783203569671 -13.018331405042485 -13.340044437128949;
 -11.924653657770566 -22.576137234824078 -1.8455783203569671 32.145288721829395 -3.3561153829103216 -3.7442669852622212;
 10.069997381652845 -3.333963796477817 -13.018331405042485 -3.3561153829103216 43.239561089743304 5.956362701306356;
 16.522416277968546 -0.7835579992866226 -13.340044437128949 -3.7442669852622212 5.956362701306356 31.23417162539543;
]
solve(n, X, P18, Q18, M18, true)
## Multiplier-1
P19 = 17853*X[1]^2//500 - 54507*X[1]*X[2]//10000 + 10177*X[1]//1000 + 6793*X[2]^2//250 + 14749*X[2]//10000 + 24583//1000
M19 = [1, X[2], X[1]]
Q19 = [24.58344930221826 0.7345357076342861 5.0825254594833105;
 0.7345357076342861 27.171677496807245 -2.7257286271548424;
 5.0825254594833105 -2.7257286271548424 35.70377799297448;
]
solve(n, X, P19, Q19, M19, true)
# sixth
## Multiplier-2
P20 = 241*X[1]^2//500 - 47*X[1]*X[2]//2000 + 269*X[1]//5000 + 551*X[2]^2//1000 + 219*X[2]//1000 + 12//25
M20 = [1, X[2], X[1]]
Q20 = [0.4798192230525684 0.10958703238850791 0.026712676937037078;
 0.10958703238850791 0.551521015829532 -0.011967782663415381;
 0.026712676937037078 -0.011967782663415381 0.4820542616181622;
]
solve(n, X, P20, Q20, M20, true)
## Total Decomposition
P21 = 3049*X[1]^4//5000 - 411*X[1]^3*X[2]//6250 - 601*X[1]^3//1250 + 4983*X[1]^2*X[2]^2//5000 - 7543*X[1]^2*X[2]//10000 + 839*X[1]^2//1000 - 119*X[1]*X[2]^3//5000 - 4187*X[1]*X[2]^2//10000 - 1573*X[1]*X[2]//10000 - 299*X[1]//625 + 5513*X[2]^4//10000 - 759*X[2]^3//1000 + 5711*X[2]^2//10000 - 6753*X[2]//10000 + 1279//1000
M21 = [1, X[2], X[1], X[2]^2, X[1]*X[2], X[1]^2]
Q21 = [1.2791997826810393 -0.33792427485436766 -0.2391652668328293 -0.19063747930661798 -0.19124260998225948 -0.02480357990027872;
 -0.33792427485436766 0.9527108309338437 0.11351806564052834 -0.37988786256145657 -0.11573034869054873 -0.17651669113238527;
 -0.2391652668328293 0.11351806564052834 0.8873009529100634 -0.09369093867686248 -0.2007456354076399 -0.24071125636872953;
 -0.19063747930661798 -0.37988786256145657 -0.09369093867686248 0.5515210158295317 -0.011967782663414932 0.09421074844699404;
 -0.19124260998225948 -0.11573034869054873 -0.2007456354076399 -0.011967782663414932 0.8083863327231617 -0.03261089049620999;
 -0.02480357990027872 -0.17651669113238527 -0.24071125636872953 0.09421074844699404 -0.03261089049620999 0.610270048314029;
]
solve(n, X, P21, Q21, M21, true)
## Multiplier-1
P22 = 61*X[1]^2//100 - 131*X[1]*X[2]//2000 + 129*X[1]//1000 + 103*X[2]^2//200 + 181*X[2]//5000 + 133//250
M22 = [1, X[2], X[1]]
Q22 = [0.5319992874826145 0.017949935108163173 0.06442376095440751;
 0.017949935108163173 0.5147535680261434 -0.0326108904962103;
 0.06442376095440751 -0.0326108904962103 0.6102700483140284;
]
solve(n, X, P22, Q22, M22, true)

@show SOS_time Newton_time